name: ${PROJECT}
description: ${DESCRIPTION}
runtime: yaml
template:
  description: A minimal Scaleway YAML program

variables:
  region: fr-par
  version: 1.23

resources:
  pulumi-kapsule:
    type: scaleway:KubernetesCluster
    properties:
      name: pulumi-kapsule
      region: ${region}
      version: ${version}
      cni: cilium
      autoUpgrade:
        enable: true
        maintenanceWindowDay: monday
        maintenanceWindowStartHour: 3
      tags:
        - pulumi
        - kapsule

  pulumi-kapsule-node-pool:
    type: scaleway:KubernetesNodePool
    properties:
      zone: ${region}-1
      region: ${region}
      name: "pulumi-kapsule-pool"
      nodeType: "DEV1-L"
      size: 1
      autoscaling: true
      minSize: 1
      maxSize: 3
      autohealing: true
      clusterId: ${pulumi-kapsule.id}

outputs:
  kapsuleId: ${pulumi-kapsule.id}
  kubeconfig:
    Fn::Secret:
      ${pulumi-kapsule.kubeconfigs[0].configFile}
